<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Web Pixel</title>
        <script>
            let messagePort = null;

            // Listen for the MessageChannel port from parent
            window.addEventListener('message', function(event) {
                if (event.data === 'INIT_CHANNEL') {
                    messagePort = event.ports[0];
                    setupGTMDebug();
                }
            });

            function setupGTMDebug() {
                // Create a proxy for GTM debug messages
                window._debugBadgeApi = {
                    setReceiver: function(receiver) {
                        // When GTM sets a receiver, store it to forward messages
                        window._gtmDebugReceiver = receiver;
                    },
                    sendMessage: function(message) {
                        // Forward messages to parent through MessageChannel
                        if (messagePort) {
                            messagePort.postMessage({
                                type: 'GTM_DEBUG_MESSAGE',
                                data: message
                            });
                        }
                    }
                };

                // Initialize GTM with original snippet
                (function(w,d,s,l,i){
                    w[l]=w[l]||[];
                    w[l].push({
                        'gtm.start': new Date().getTime(),
                        event:'gtm.js'
                    });
                    var f=d.getElementsByTagName(s)[0],
                    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
                    j.async=true;
                    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
                    f.parentNode.insertBefore(j,f);
                })(window,document,'script','dataLayer','GTM-T36KSSBM');
            }
        </script>
    </head>
    <body>
        <!-- Google Tag Manager (noscript) -->
        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T36KSSBM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
        </noscript>
        <!-- End Google Tag Manager (noscript) -->
    </body>
</html>